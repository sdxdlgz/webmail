<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outlook 邮件管理系统</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Login Page -->
        <div id="login-page" class="page">
            <div class="login-container">
                <h1>Outlook 邮件管理</h1>
                <p class="subtitle">统一管理您的多个邮箱账号</p>
                <form id="login-form">
                    <div class="form-group">
                        <label for="username">用户名</label>
                        <input type="text" id="username" name="username" required placeholder="请输入用户名">
                    </div>
                    <div class="form-group">
                        <label for="password">密码</label>
                        <input type="password" id="password" name="password" required placeholder="请输入密码">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">登录</button>
                    <div id="login-error" class="error-message"></div>
                </form>
                <div id="register-link" class="register-link hidden">
                    <p>还没有账号？<a href="#" id="show-register">立即注册</a></p>
                </div>
            </div>
        </div>

        <!-- Register Page -->
        <div id="register-page" class="page hidden">
            <div class="login-container">
                <h1>用户注册</h1>
                <p class="subtitle">创建您的账号</p>
                <form id="register-form">
                    <div class="form-group">
                        <label for="reg-username">用户名</label>
                        <input type="text" id="reg-username" name="username" required placeholder="请输入用户名 (3-64字符)" minlength="3" maxlength="64">
                    </div>
                    <div class="form-group">
                        <label for="reg-password">密码</label>
                        <input type="password" id="reg-password" name="password" required placeholder="请输入密码 (至少6位)" minlength="6" maxlength="128">
                    </div>
                    <div class="form-group">
                        <label for="reg-password-confirm">确认密码</label>
                        <input type="password" id="reg-password-confirm" name="password_confirm" required placeholder="请再次输入密码">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">注册</button>
                    <div id="register-error" class="error-message"></div>
                </form>
                <div class="register-link">
                    <p>已有账号？<a href="#" id="show-login">返回登录</a></p>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="main-app" class="page hidden">
            <!-- Header -->
            <header class="header">
                <h1>Outlook 邮件管理</h1>
                <div class="header-actions">
                    <span id="current-user"></span>
                    <button id="logout-btn" class="btn btn-secondary">退出</button>
                </div>
            </header>

            <!-- Navigation -->
            <nav class="nav-tabs">
                <button class="tab-btn active" data-tab="accounts">邮箱管理</button>
                <button class="tab-btn" data-tab="mail">邮件查看</button>
                <button class="tab-btn admin-only hidden" data-tab="admin">系统管理</button>
            </nav>

            <!-- Accounts Tab -->
            <div id="accounts-tab" class="tab-content active">
                <!-- Toolbar -->
                <div class="toolbar">
                    <div class="toolbar-left">
                        <input type="text" id="account-search" placeholder="搜索邮箱..." class="search-input">
                        <select id="group-filter" class="select-input">
                            <option value="">全部分组</option>
                        </select>
                        <select id="status-filter" class="select-input">
                            <option value="">全部状态</option>
                            <option value="active">有效</option>
                            <option value="invalid">失效</option>
                            <option value="unknown">未知</option>
                        </select>
                    </div>
                    <div class="toolbar-right">
                        <button id="add-account-btn" class="btn btn-primary">添加账号</button>
                        <button id="batch-import-btn" class="btn btn-secondary">批量导入</button>
                        <button id="batch-verify-btn" class="btn btn-secondary">批量测活</button>
                        <button id="export-btn" class="btn btn-secondary">导出</button>
                        <button id="manage-groups-btn" class="btn btn-secondary">分组管理</button>
                    </div>
                </div>

                <!-- Accounts Table -->
                <div class="table-container">
                    <table id="accounts-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="select-all"></th>
                                <th>邮箱</th>
                                <th>备注</th>
                                <th>分组</th>
                                <th>状态</th>
                                <th>最后验证</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="accounts-tbody"></tbody>
                    </table>
                </div>

                <!-- Batch Actions -->
                <div id="batch-actions" class="batch-actions hidden">
                    <span id="selected-count">已选择 0 项</span>
                    <button id="batch-delete-btn" class="btn btn-danger">批量删除</button>
                </div>
            </div>

            <!-- Mail Tab -->
            <div id="mail-tab" class="tab-content hidden">
                <div class="mail-layout">
                    <!-- Account Selector -->
                    <div class="mail-sidebar">
                        <h3>选择邮箱</h3>
                        <div class="account-list-container">
                            <div id="account-list" class="account-list">
                                <div class="empty-state" style="padding: 20px;">
                                    <p>暂无可用账号</p>
                                </div>
                            </div>
                        </div>

                        <h3>文件夹</h3>
                        <ul id="folder-list" class="folder-list"></ul>
                    </div>

                    <!-- Mail List -->
                    <div class="mail-main">
                        <div class="mail-toolbar">
                            <input type="text" id="mail-search" placeholder="搜索邮件..." class="search-input" style="flex: 1;">
                            <button id="refresh-mail-btn" class="btn btn-secondary">刷新</button>
                        </div>
                        <div id="mail-list" class="mail-list">
                            <div class="empty-state">
                                <p>请先选择一个账号</p>
                            </div>
                        </div>
                        <div id="mail-pagination" class="pagination"></div>
                    </div>
                </div>
            </div>

            <!-- Admin Tab -->
            <div id="admin-tab" class="tab-content hidden">
                <div class="admin-layout">
                    <!-- System Settings -->
                    <div class="admin-section">
                        <h3>系统设置</h3>
                        <div class="settings-form">
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" id="allow-registration">
                                    允许用户注册
                                </label>
                                <p class="setting-desc">开启后，用户可以自行注册账号</p>
                            </div>
                            <button id="save-settings-btn" class="btn btn-primary">保存设置</button>
                        </div>
                    </div>

                    <!-- User Management -->
                    <div class="admin-section">
                        <h3>用户管理</h3>
                        <div class="toolbar">
                            <div class="toolbar-left">
                                <input type="text" id="user-search" placeholder="搜索用户..." class="search-input">
                            </div>
                            <div class="toolbar-right">
                                <button id="add-user-btn" class="btn btn-primary">添加用户</button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table id="users-table">
                                <thead>
                                    <tr>
                                        <th>用户名</th>
                                        <th>角色</th>
                                        <th>需改密</th>
                                        <th>创建时间</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="users-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <!-- Add Account Modal -->
        <div id="add-account-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>添加账号</h2>
                    <button class="close-btn">&times;</button>
                </div>
                <form id="add-account-form">
                    <div class="form-group">
                        <label for="acc-email">邮箱</label>
                        <input type="email" id="acc-email" required>
                    </div>
                    <div class="form-group">
                        <label for="acc-password">密码 (可选)</label>
                        <input type="text" id="acc-password">
                    </div>
                    <div class="form-group">
                        <label for="acc-refresh-token">Refresh Token</label>
                        <textarea id="acc-refresh-token" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="acc-client-id">Client ID</label>
                        <input type="text" id="acc-client-id" required>
                    </div>
                    <div class="form-group">
                        <label for="acc-group">分组</label>
                        <select id="acc-group" class="select-input"></select>
                    </div>
                    <div class="form-group">
                        <label for="acc-remark">备注</label>
                        <input type="text" id="acc-remark" placeholder="可选，添加备注信息">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary close-btn">取消</button>
                        <button type="submit" class="btn btn-primary">添加</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Batch Import Modal -->
        <div id="batch-import-modal" class="modal hidden">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>批量导入</h2>
                    <button class="close-btn">&times;</button>
                </div>
                <form id="batch-import-form">
                    <div class="form-group">
                        <label>导入方式</label>
                        <div class="import-tabs">
                            <button type="button" class="import-tab active" data-mode="text">粘贴文本</button>
                            <button type="button" class="import-tab" data-mode="file">上传文件</button>
                        </div>
                    </div>
                    <div id="import-text-mode" class="form-group">
                        <label>格式: 邮箱----密码----refresh_token----client_id</label>
                        <textarea id="import-data" rows="10" placeholder="每行一个账号..."></textarea>
                    </div>
                    <div id="import-file-mode" class="form-group hidden">
                        <label>选择 TXT 文件</label>
                        <div class="file-upload-area" id="file-upload-area">
                            <input type="file" id="import-file" accept=".txt" style="display: none;">
                            <div class="file-upload-content">
                                <p class="file-upload-icon">📄</p>
                                <p>点击选择文件或拖拽文件到此处</p>
                                <p class="file-upload-hint">支持 .txt 文件</p>
                            </div>
                            <div id="file-selected" class="file-selected hidden">
                                <span id="file-name"></span>
                                <button type="button" class="btn btn-small btn-secondary" id="clear-file">清除</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="import-group">导入到分组</label>
                        <select id="import-group" class="select-input"></select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary close-btn">取消</button>
                        <button type="submit" class="btn btn-primary">导入</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Account Modal -->
        <div id="edit-account-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>编辑账号</h2>
                    <button class="close-btn">&times;</button>
                </div>
                <form id="edit-account-form">
                    <input type="hidden" id="edit-acc-id">
                    <div class="form-group">
                        <label for="edit-acc-email">邮箱</label>
                        <input type="email" id="edit-acc-email" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-acc-password">密码</label>
                        <input type="text" id="edit-acc-password" placeholder="留空不修改">
                    </div>
                    <div class="form-group">
                        <label for="edit-acc-refresh-token">Refresh Token</label>
                        <textarea id="edit-acc-refresh-token" rows="3" placeholder="留空不修改"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-acc-client-id">Client ID</label>
                        <input type="text" id="edit-acc-client-id">
                    </div>
                    <div class="form-group">
                        <label for="edit-acc-group">分组</label>
                        <select id="edit-acc-group" class="select-input"></select>
                    </div>
                    <div class="form-group">
                        <label for="edit-acc-remark">备注</label>
                        <input type="text" id="edit-acc-remark" placeholder="可选，添加备注信息">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary close-btn">取消</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Groups Modal -->
        <div id="groups-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>分组管理</h2>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="groups-content">
                    <div class="form-group">
                        <label>添加新分组</label>
                        <div class="input-group">
                            <input type="text" id="new-group-name" placeholder="分组名称">
                            <button id="add-group-btn" class="btn btn-primary">添加</button>
                        </div>
                    </div>
                    <ul id="groups-list" class="groups-list"></ul>
                </div>
            </div>
        </div>

        <!-- Mail Detail Modal -->
        <div id="mail-detail-modal" class="modal hidden">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 id="mail-subject">邮件详情</h2>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="mail-detail-content">
                    <div class="mail-meta">
                        <p><strong>发件人:</strong> <span id="mail-from"></span></p>
                        <p><strong>收件人:</strong> <span id="mail-to"></span></p>
                        <p><strong>抄送:</strong> <span id="mail-cc"></span></p>
                        <p><strong>时间:</strong> <span id="mail-date"></span></p>
                    </div>
                    <div id="mail-body" class="mail-body"></div>
                </div>
                <div class="modal-footer">
                    <button id="delete-mail-btn" class="btn btn-danger">删除邮件</button>
                    <button class="btn btn-secondary close-btn">关闭</button>
                </div>
            </div>
        </div>

        <!-- Verify Progress Modal -->
        <div id="verify-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>批量测活</h2>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="verify-content">
                    <div id="verify-progress" class="progress-bar">
                        <div id="verify-progress-inner" class="progress-inner"></div>
                    </div>
                    <p id="verify-status">正在验证...</p>
                    <div id="verify-results" class="verify-results"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-btn">关闭</button>
                </div>
            </div>
        </div>

        <!-- Confirm Dialog Modal -->
        <div id="confirm-modal" class="modal hidden">
            <div class="modal-content modal-small">
                <div class="modal-header">
                    <h2 id="confirm-title">确认操作</h2>
                </div>
                <div class="confirm-content">
                    <p id="confirm-message">确定要执行此操作吗？</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="confirm-cancel-btn">取消</button>
                    <button type="button" class="btn btn-danger" id="confirm-ok-btn">确定</button>
                </div>
            </div>
        </div>

        <!-- Change Password Modal (Force on first login) -->
        <div id="change-password-modal" class="modal hidden">
            <div class="modal-content modal-small">
                <div class="modal-header">
                    <h2>修改密码</h2>
                </div>
                <form id="change-password-form">
                    <div class="form-group">
                        <label for="cp-new-username">新用户名 (可选)</label>
                        <input type="text" id="cp-new-username" placeholder="留空则不修改" minlength="3" maxlength="64">
                    </div>
                    <div class="form-group">
                        <label for="cp-old-password">当前密码</label>
                        <input type="password" id="cp-old-password" required placeholder="请输入当前密码">
                    </div>
                    <div class="form-group">
                        <label for="cp-new-password">新密码</label>
                        <input type="password" id="cp-new-password" required placeholder="请输入新密码 (至少6位)" minlength="6" maxlength="128">
                    </div>
                    <div class="form-group">
                        <label for="cp-confirm-password">确认新密码</label>
                        <input type="password" id="cp-confirm-password" required placeholder="请再次输入新密码">
                    </div>
                    <div id="change-password-error" class="error-message"></div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">确认修改</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add User Modal (Admin) -->
        <div id="add-user-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>添加用户</h2>
                    <button class="close-btn">&times;</button>
                </div>
                <form id="add-user-form">
                    <div class="form-group">
                        <label for="new-user-username">用户名</label>
                        <input type="text" id="new-user-username" required placeholder="请输入用户名" minlength="3" maxlength="64">
                    </div>
                    <div class="form-group">
                        <label for="new-user-password">密码</label>
                        <input type="password" id="new-user-password" required placeholder="请输入密码" minlength="6" maxlength="128">
                    </div>
                    <div class="form-group">
                        <label for="new-user-role">角色</label>
                        <select id="new-user-role" class="select-input">
                            <option value="user">普通用户</option>
                            <option value="admin">管理员</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary close-btn">取消</button>
                        <button type="submit" class="btn btn-primary">添加</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit User Modal (Admin) -->
        <div id="edit-user-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>编辑用户</h2>
                    <button class="close-btn">&times;</button>
                </div>
                <form id="edit-user-form">
                    <input type="hidden" id="edit-user-id">
                    <div class="form-group">
                        <label for="edit-user-username">用户名</label>
                        <input type="text" id="edit-user-username" placeholder="留空不修改" minlength="3" maxlength="64">
                    </div>
                    <div class="form-group">
                        <label for="edit-user-password">新密码</label>
                        <input type="password" id="edit-user-password" placeholder="留空不修改" minlength="6" maxlength="128">
                    </div>
                    <div class="form-group">
                        <label for="edit-user-role">角色</label>
                        <select id="edit-user-role" class="select-input">
                            <option value="user">普通用户</option>
                            <option value="admin">管理员</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary close-btn">取消</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Toast -->
        <div id="toast" class="toast hidden"></div>
    </div>

    <script src="app.js"></script>
</body>
</html>
